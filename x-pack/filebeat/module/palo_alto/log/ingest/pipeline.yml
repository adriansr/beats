description: "Pipeline for Palo Alto PAN-OS Logs"
processors:

 - set:
     field: log.original
     value: '{{ message }}'
 - grok:
     field: _temp_.syslog_header
     patterns:
       - '(:?%{SYSLOGTIMESTAMP:_temp_.raw_date})? %{SYSLOGHOST:_temp_.host_name} %{GREEDYDATA}'

#
# Parse the date included in ASA logs
#
 - date:
     field: "_temp_.raw_date"
     ignore_failure: true
     {< if .convert_timezone >}
     timezone: "{{ event.timezone }}"
     {< end >}
     formats:
       - "MMM  d HH:mm:ss"
       - "MMM dd HH:mm:ss"

  - foreach:
      field: _temp_.to_int
      ignore_missing: true
      processor:
        convert:
          field: '_ingest._value'
          type: integer
          ignore_missing: true
          ignore_failure: true

 - remove:
     field:
       - message
       - _temp_
     ignore_missing: true

on_failure:
  - set:
      field: "error.message"
      value: "{{ _ingest.on_failure_message }}"
  - remove:
      field:
        - _temp_
      ignore_missing: true
